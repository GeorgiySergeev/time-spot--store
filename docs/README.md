# Time-Sphere Catalog API System

## Overview

Unified API system for Time-Sphere watch catalog integration with Cockpit CMS. This system provides complete product catalog functionality with filtering, sorting, and responsive design.

## Architecture

### Core Components

#### config.js

- **Purpose**: Central configuration for API endpoints, UI settings, and data normalization
- **Key Features**:
  - Cockpit CMS integration settings
  - Filter configuration (price range, brands, categories)
  - Image URL management
  - Product data normalization for confirmed CMS structure

#### api.js

- **Purpose**: API service layer for Cockpit CMS communication
- **Key Functions**:
  - `getProducts(filters)`: Fetch products with optional filtering
  - `getProductById(id)`: Get single product details
  - `getBrands()`: Get available brands for filters
  - `getProductsByCategory(category)`: Category-specific product fetching

#### templates.js

- **Purpose**: HTML template generation for all UI components
- **Templates Available**:
  - Product cards (grid view)
  - Product list items (list view)
  - Filter sidebar
  - Loading/error/empty states
  - Pagination controls

#### renderer.js

- **Purpose**: Main rendering engine with state management
- **Key Features**:
  - State management for filters, sorting, pagination
  - Event handling for user interactions
  - Local filtering for better UX
  - Automatic filter sidebar updates

#### api-utils.js

- **Purpose**: Error handling and common utilities
- **Features**:
  - Comprehensive error handling
  - API response validation
  - User-friendly error messages

## Data Structure

### Cockpit CMS Fields (Confirmed)

```javascript
{
  id: string,           // Unique identifier
  brand: string,        // Product brand
  model: string,        // Product model
  price: number,        // Product price
  img: object,          // Image object with path
  category: string,     // Category: 'watch', 'jewelry', 'accessories'
  in_stock: boolean     // Stock availability
}
```

### Normalized Product Object

```javascript
{
  id: string,
  brand: string,
  model: string,
  name: string,         // Combined brand + model
  price: number,
  imageUrl: string,     // Full image URL
  category: string,
  inStock: boolean,
  url: string,          // Product details URL
  formattedPrice: string, // Localized price format
  sku: string           // Generated SKU
}
```

## Usage

### Basic Integration

```javascript
import { initializeCatalog } from './api/renderer.js'

// Initialize catalog on page load
document.addEventListener('DOMContentLoaded', () => {
  initializeCatalog('products') // 'products' is the container ID
})
```

### Manual Product Loading

```javascript
import { getProducts } from './api/api.js'
import { renderProducts } from './api/renderer.js'

// Load products with filters
const filters = {
  priceMin: 100,
  priceMax: 1000,
  brands: ['Rolex', 'Omega'],
  category: 'watch',
}

const { products, filters: availableFilters } = await getProducts(filters)
renderProducts(products, 'products-container')
```

### Global Functions (Available in HTML)

```javascript
// Available for onclick handlers
window.productCatalog = {
  refresh: (containerId) => {}, // Reload products
  showSamples: (containerId) => {}, // Show sample data
  clearFilters: () => {}, // Reset all filters
  goToPage: (page) => {}, // Navigate to page
  search: (query) => {}, // Search products
}
```

## Filter System

### Supported Filters

- **Price Range**: Min/max price filtering
- **Brands**: Multi-select brand filtering
- **Categories**: Single category selection
- **Stock Status**: In-stock only option
- **Search**: Text search across name, brand, model

### Filter UI Components

```html
<!-- Automatically generated by createFilterSidebar() -->
<div id="filter-sidebar">
  <!-- Price range slider -->
  <!-- Brand checkboxes -->
  <!-- Stock availability toggle -->
  <!-- Clear filters button -->
</div>
```

## Configuration Options

### API Configuration

```javascript
// In config.js
export const API_CONFIG = {
  API_KEY: 'your-cockpit-api-key',
  BASE_URL: 'https://your-cockpit-instance.com/admin/api',
  ENDPOINTS: {
    PRODUCTS: '/content/items/watch',
  },
  FILTERS: {
    PRICE: { MIN: 0, MAX: 5000, STEP: 50 },
  },
}
```

### UI Configuration

```javascript
UI: {
  DEFAULT_CONTAINER: 'products',
  PRODUCTS_PER_PAGE: 12,
  VIEW_MODES: ['grid', 'list'],
  DEFAULT_VIEW: 'grid'
}
```

## Error Handling

### Error Types

- **Network Errors**: Connection issues, timeouts
- **API Errors**: 4xx/5xx HTTP responses
- **Data Errors**: Invalid or missing data structures
- **UI Errors**: Missing containers or invalid states

### Error Display

- User-friendly error messages
- Retry functionality
- Fallback to sample products
- Console logging for debugging

## Performance Features

### Client-Side Optimizations

- **Local Filtering**: Filter products without API calls
- **Debounced Search**: 300ms delay on search input
- **Lazy Loading**: Images load as needed
- **State Management**: Efficient re-rendering

### API Optimizations

- **Request Caching**: Avoid duplicate API calls
- **Query Building**: Efficient server-side filtering
- **Error Retry**: Automatic retry with backoff

## Browser Support

### Minimum Requirements

- ES6 module support
- Fetch API
- Promise support
- Modern CSS (Grid, Flexbox)

### Tested Browsers

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## Development Workflow

### Adding New Filters

1. Update `API_CONFIG.FILTERS` in config.js
2. Add filter UI in `createFilterSidebar()` template
3. Add filter logic in `filterProducts()` function
4. Update API query building if server-side filtering needed

### Adding New Templates

1. Create template function in templates.js
2. Export the function
3. Import and use in renderer.js
4. Test with various data states

### Debugging

- Enable debug mode: `API_CONFIG.DEBUG = true`
- Check browser console for detailed logs
- Use sample products for testing: `productCatalog.showSamples()`

## SEO Considerations

### Current Implementation

- Semantic HTML structure
- Proper heading hierarchy
- Alt text for images
- Accessible form controls

### Future Enhancements

- Server-side rendering for initial content
- Structured data (JSON-LD) for products
- Meta tag updates based on filters
- Social media sharing optimization

## Security

### API Security

- API key authorization
- Request timeout limits
- Input validation
- XSS prevention in templates

### Best Practices

- Sanitize user inputs
- Validate API responses
- Use HTTPS for API calls
- Implement rate limiting

## Migration Notes

### From Previous System

- ✅ Replaced dual API structure (api/ + api-2/)
- ✅ Unified configuration management
- ✅ Standardized template system
- ✅ Improved error handling
- ✅ Added comprehensive filtering

### Breaking Changes

- Template function signatures changed
- Configuration structure updated
- Global function names updated
- Event handling consolidated

## Support

For issues or questions about the API system:

1. Check browser console for error messages
2. Verify API configuration in config.js
3. Test with sample products first
4. Review this documentation for proper usage
